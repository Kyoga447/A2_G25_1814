/* Create & use database */
CREATE DATABASE IF NOT EXISTS aSFashion25;

USE aSFashion25;

SHOW TABLES;

CREATE TABLE IF NOT EXISTS CUSTOMER(
	Cust_Number 	INT PRIMARY KEY AUTO_INCREMENT,
	Cust_FName	VARCHAR(30),
	Cust_LName	VARCHAR(30),
	Cust_Phone	CHAR(10),
	Cust_Email	VARCHAR(60)
) ENGINE=InnoDB;

CREATE TABLE IF NOT EXISTS APPOINTMENT(
	Apt_Lvl_ID	CHAR(2) PRIMARY KEY,
	Apt_Lvl_Desc	VARCHAR(40),
	Apt_Hourly_Rate	DECIMAL(5,2)
) ENGINE=InnoDB;

CREATE TABLE IF NOT EXISTS STORE(
	Str_Num		INT PRIMARY KEY AUTO_INCREMENT,
	Str_Name	VARCHAR(50),
	Str_Phone	CHAR(10),
	Str_Email	VARCHAR(40),
	StoreManagerID	INT NOT NULL
) ENGINE=InnoDB;

CREATE TABLE IF NOT EXISTS STAFF(
	Staff_ID	INT PRIMARY KEY AUTO_INCREMENT,
	Staff_FName	VARCHAR(30),
	Staff_LName	VARCHAR(30),
	Staff_Phone	CHAR(10),
	Staff_DoB	DATE,
	Staff_StartDate	DATE,
	Staff_Apt_Level	CHAR(2),
	Store_ID	INT,
	SupervisorID	INT,
	FOREIGN KEY (Store_ID) REFERENCES STORE(Str_Num),
	FOREIGN KEY (SupervisorID) REFERENCES STAFF(Staff_ID),
	FOREIGN KEY (Staff_Apt_Level) REFERENCES APPOINTMENT(Apt_Lvl_ID)
) ENGINE=InnoDB;

ALTER TABLE STORE
ADD CONSTRAINT fk_store_staff
FOREIGN KEY (StoreManagerID) 
REFERENCES STAFF(Staff_ID);

CREATE TABLE IF NOT EXISTS PRODUCTTYPE(
	Prod_TypeID	INT PRIMARY KEY AUTO_INCREMENT,
	Prod_Type_Desc VARCHAR(40)
) ENGINE=InnoDB;

CREATE TABLE IF NOT EXISTS PRODUCT(
	Prod_Num    INT PRIMARY KEY AUTO_INCREMENT, 
	Prod_desc   VARCHAR(50), -- e.g. Pants for Man, Skirts for Girl
	Prod_Size   VARCHAR(10), -- e.g. Large, Medium, XL, 14, etc
	Prod_Price  DECIMAL(5,2), -- e.g. 110.50 (actual price)
	Price_Discount  DECIMAL(4,2), -- e.g. 11.35
	Prod_TypeID INT,
	FOREIGN KEY (Prod_TypeID) REFERENCES PRODUCTTYPE(Prod_TypeID)
) ENGINE=InnoDB;

CREATE TABLE IF NOT EXISTS INVENTORY(
	Prod_Num    INT,
	Str_Num     INT,
	Inv_QntyOnHand  INT,
	Inv_QtyOrdered  INT,
	PRIMARY KEY (Prod_Num, Str_Num),
	FOREIGN KEY (Prod_Num) REFERENCES PRODUCT(Prod_Num),
	FOREIGN KEY (Str_Num) REFERENCES STORE(Str_Num)
) ENGINE=InnoDB;

CREATE TABLE IF NOT EXISTS ORDERMODE(
	Order_ModeID    CHAR(1) PRIMARY KEY,
	Order_Mode_Desc     VARCHAR(10)
) ENGINE=InnoDB;

CREATE TABLE IF NOT EXISTS CUSTOMERORDER(
	CustOrd_ID  INT PRIMARY KEY AUTO_INCREMENT,
	CustOrd_Date    DATE,
	CustOrd_Mode    CHAR(1),
	Cust_Number     INT,
	Str_Num     INT,
	FOREIGN KEY (CustOrd_Mode) REFERENCES ORDERMODE(Order_ModeID),
	FOREIGN KEY (Cust_Number) REFERENCES CUSTOMER(Cust_Number),
	FOREIGN KEY (Str_Num) REFERENCES STORE(Str_Num)
) ENGINE=InnoDB;

CREATE TABLE IF NOT EXISTS ORDERLINE(
	CustOrd_ID  INT,
	Prod_Num INT,
	OrdLn_DateArrived   DATE, -- same as order date (CustOrd_Date) or later
	OrdLn_DatePicked    DATE, -- same as arrival date (DateArrived) or later
	OrdLn_Qnty  INT,
	PRIMARY KEY (CustOrd_ID, Prod_Num),
	FOREIGN KEY (CustOrd_ID) REFERENCES CUSTOMERORDER(CustOrd_ID),
	FOREIGN KEY (Prod_Num) REFERENCES PRODUCT(Prod_Num)
) ENGINE=InnoDB;
